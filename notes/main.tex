\documentclass{ctexart}
\include{./header_art.tex}
\usepackage[version=4]{mhchem}
\usepackage[a4paper,scale=0.8]{geometry}
\usepackage{systeme}
\usepackage{algorithm}
\usepackage{algpseudocode}

\newcommand{\grayplus}{\,\color{lightgray}+\,}
\newcommand{\grayto}{\,\color{lightgray}\to\,}
\DeclareMathOperator{\nullspace}{null}
\DeclareMathOperator{\range}{range}
\DeclareMathOperator{\Span}{span}
\DeclareMathOperator{\Hom}{Hom}

\renewcommand{\L}{\mathscr{L}}

\addbibresource{references.bib}

\title{化学方程式配平的数学原理}
\begin{document}
\author{\Large \Caffein}
\date{}
\maketitle
\tableofcontents

\section{线性方程组}
\subsection{蒙昧未开}
我想最开始学习的时候，每个人都把化学方程式配平当成一个数学游戏。

最简单的，我们考虑化学方程式\(\ce{H2S + SO2 \to S v + H2O}\) 。
设系数\[
    x \ce{H2S} + y \ce{SO2} \to z \ce{S} + t \ce{H2O}
\]
求解：
\[
    \begin{array}{lcr@{\quad}rcl@{\quad}l}
        \ce{S}:  x+y &=& z & z &=& \frac{3t}{2} & \\
        \ce{O}: 2x &=& t & \implies  \quad x &=& \frac{t}{2} &
        \implies \quad \text{取 } t=2: \\
        \ce{H}: 2y &=& 2t & y &=& t &
    \end{array}
    \begin{cases}
        x = 1 \\
        y = 2 \\
        z = 3
    \end{cases}
\]

于是\[
    \ce{H2S + 2 SO2 -> 3 S v + 2 H2O}
\]

理论上，任何化学方程式都可以通过列线性方程组来配平。但能否能配的出来就在于你的算力了\UseVerb{laugh}。

\subsubsection{为什么见到的方程式都能恰好配平？}
其实不能\UseVerb{smile}

如果我们随便列一个化学方程式，很大概率是配不出来的。如\(\ce{SiO2 \to Au}\)\sout{（点石成金 \UseVerb{naughty}）}。
即便元素相等，也未必配的出来。如
\(\ce{H2O + CO2 \to C2H5OH}\) 。

另外，能配出来的方程式也不一定唯一。考虑高中常见的化学方程式：\[
    \ce{2 MnO4^- + 5 H2O2 + 6 H^+ -> 2 Mn^2+ + 5 O2 ^ + 8 H2O}
\]

不难发现\[
    \ce{2 MnO4^- + 7 H2O2 + 6 H^+ -> 2 Mn^2+ + 6 O2 ^ + 10 H2O}
\]
也是一个解。

实际上，以下两个方程式的线性组合，都是合理的化学方程式：
\begin{align*}
    &\ce{2 MnO4^- + 5 H2O2 + 6 H^+ -> 2 Mn^2+ + 5 O2 ^ + 8 H2O} \\
    &\ce{2 H2O2 -> 2 O2 ^ + 2 H2O}
\end{align*}

\subsection{配平化学方程式的数学原理}

首先我们对配平这件事限定一个范围：\hl{我们最多能接受有理数的化学系数}，我们接受：

\begin{itemize}
    \item \checkmark 负的化学系数
    \item \checkmark 分数化学系数
\end{itemize}
至于建立在一般\(\R\)
甚至\(\C\) 上的化学方程式，

\begin{align*}
    \ce{2\sqrt{2} H2O2 &->[MnO2] \sqrt{2}O2 ^ + 2\sqrt{2} H2O}\\
    \ce{2\sqrt{6} KMnO4 + (5\sqrt{6} + 2\i)H2O2 + 3\sqrt{6}H2SO4 &\to
        \sqrt{6}K2SO4 + 2\sqrt{6}MnSO4 \\
    & \qquad {} + (5\sqrt{6} + \i)O2 ^ + (8\sqrt{6} + 2\i)H2O}
\end{align*}\footnote{读者可以验证，他们确实是平的\UseVerb{naughty}}
我们在这里不做讨论。

配平化学方程式的基本原理，在于我们初识化学时就学过的：
\textbf{元素守恒定律}~\cite{HuaXueJiuNianJiShangCe}。即在化学反应中，各元素的总原子数保持不变。

其次，作为数学对象，我们有充分的理由大胆的对化学方程式进行移项：
\[
    x \ce{H2S} + y \ce{SO2} - z \ce{S} - t \ce{H2O} = \vec{0}
\]
这里的\(\vec{0}\)表示“零化学式”，即不含任何元素的化学式。是不是非常大胆 \UseVerb{wink}

于是，求解方程式所有的信息，都蕴含在所有元素的守恒律中，隐藏在下面的方程组里：
\[
    \begin{array}{c|*{3}{c@{\grayplus}}c|c}
        & \multicolumn{1}{c@{\grayplus}}{\ce{H2S}} &
        \multicolumn{1}{c@{\grayto}}{\ce{SO2}} &
        \multicolumn{1}{c@{\grayplus}}{\ce{S}} &
        \multicolumn{1}{c|}{\ce{H2O}} & \text{sum} \\
        \hline
        \ce{S} & x & y & -z & 0 & 0 \\
        \ce{H} & 2x & 0 & 0 & -2t & 0 \\
        \ce{O} & 0 & 2y & 0 & -t & 0 \\
    \end{array}
\]
或者我们忽略所有未知数，保留系数：
\[
    \begin{array}{c|*{3}{c@{\grayplus}}c|c}
        & \multicolumn{1}{c@{\grayplus}}{\prescript{x}{}{\ce{H2S}}} &
        \multicolumn{1}{c@{\grayto}}{\prescript{y}{}{\ce{SO2}}} &
        \multicolumn{1}{c@{\grayplus}}{\prescript{-z}{}{\ce{S}}} &
        \multicolumn{1}{c|}{\prescript{-t}{}{\ce{H2O}}} & \text{sum} \\
        \hline
        \ce{S} & 1 & 1 & 1 & 0 & 0 \\
        \ce{H} & 2 & 0 & 0 & 2 & 0 \\
        \ce{O} & 0 & 2 & 0 & 1 & 0 \\
    \end{array}
\]
就这个意义上来说，求解化学方程式，完全等价于求解一个线性的方程组。
对于那些有线性代数基础的同学不难发现，这是齐次线性方程组的标准形式！我们可以把它写成矩阵形式：
\[
    \begin{bmatrix}
        1 & 1 & 1 & 0 \\
        2 & 0 & 0 & 2 \\
        0 & 2 & 0 & 1
    \end{bmatrix}
    \begin{bmatrix}
        x \\ y \\ -z \\ -t
    \end{bmatrix}
    =
    \begin{bmatrix}
        0 \\ 0 \\ 0 \\ 0
    \end{bmatrix}
\]

为表示方便，令\( z^\prime = -z \)，\( t^\prime = -t \)。整个方程用更简洁的语言可以写成：
\[
    A \vec{x} = \vec{0}
\]

其中的\(A\)是元素-化学式矩阵，我们叫它系数矩阵吧。 \(\vec{x}\)是化学系数向量。

拆分开来，在列向量的角度看，化学式\(\ce{H2S}\)对应矩阵的第一列\(
    \begin{bmatrix}1 & 2 & 0
\end{bmatrix}^{\mathrm{T}}\)，表示它含有1个硫原子，2个氢原子，0个氧原子。依次类推，
我们本质上是将每个化学物种看作是108维元素空间内的一个向量（\textit{零向量的存在其实也隐喻了这一点}），
配平化学方程式就是在求解方程组：
\[
    x
    \begin{bmatrix}1 \\ 2 \\ 0
    \end{bmatrix} + y
    \begin{bmatrix}1 \\ 0 \\ 2
    \end{bmatrix} + z^\prime
    \begin{bmatrix}1 \\ 0 \\ 0
    \end{bmatrix} + t^\prime
    \begin{bmatrix}0 \\ 2 \\ 1
    \end{bmatrix} =
    \begin{bmatrix}0 \\ 0 \\ 0
    \end{bmatrix}
\]

\[
    x \vec{\ce{H2S}} + y \vec{\ce{SO2}} + z^\prime \vec{\ce{S}} +
    t^\prime \vec{\ce{H2O}} = \vec{0}
\]

系数矩阵就是由这些元素向量为列向量组成的矩阵。更抽象的说，求解方程式\(A\vec{x} = \vec{0}\)，
实际上就是在求解矩阵\(A\)的\textbf{零空间}。
\[
    \text{All possible solutions} = \nullspace{A}
\]

\subsection{化学方程式的数学结构}

实际不必大费周章，\textbf{只需注意到}化学方程式在代数上满足以下特性：
\begin{itemize}
    \item[\textbf{零元素：}] 谁说化学方程式不能全配零：\[
            0 \ce{H2S} + 0 \ce{SO2} \to 0 \ce{S} + 0 \ce{H2O}
        \]
        你别说有没有意义\UseVerb{angry}，你就说平没平吧？
    \item[\textbf{齐次性：}] 假设\[
            x_0 \ce{H2S} + y_0 \ce{SO2} \to z_0 \ce{S} + t_0 \ce{H2O}
        \]
        是一个平衡的化学方程式，那么对于任意的\(\lambda \in \R\)，
        \[
            \lambda x_0 \ce{H2S} + \lambda y_0 \ce{SO2} \to
            \lambda z_0 \ce{S} + \lambda t_0 \ce{H2O}
        \]
        也是一个平衡的化学方程式。
    \item[\textbf{可加性：}] 随便的两个已配平的化学方程式：\[
            x_1 \ce{H2S} + y_1 \ce{SO2} \to z_1 \ce{S} + t_1 \ce{H2O}
        \]
        和
        \[
            x_2 \ce{H2S} + y_2 \ce{SO2} \to z_2 \ce{S} + t_2 \ce{H2O}
        \]
        它们的和
        \[
            (x_1 + x_2) \ce{H2S} + (y_1 + y_2) \ce{SO2} \to
            (z_1 + z_2) \ce{S} + (t_1 + t_2) \ce{H2O}
        \]
        也是一个平衡的化学方程式。
\end{itemize}

于是我们知道，所有可配平的化学方程式构成一个\textbf{线性空间}！\footnote{当然这不是一个严谨的证明，
实际上只证明了这个特定的方程式的解集是某线性空间的子空间。严谨的证明是无聊且平凡的\UseVerb{grin}}。结合我们先前的推论，
不难发现这实际上就是系数矩阵\(A\) 的零空间\(\nullspace A\) 那么求解化学方程式的全部任务就完全变成了求解这个线性空间的一个基底的问题。

\subsection{机械化的消元法}
我们求解一下前面的线性方程组：
\[
    \begin{tikzcd}[column sep=large, row sep=large]
        \systeme[sort={x, y, z, t}]{
            x + y + z^{\prime} = 0,
            2x + 2t^{\prime} = 0,
            2y + t^{\prime} = 0
        }
        \arrow[r] &
        \systeme[sort={x, y, z, t}]{
            x + y + z^{\prime} = 0,
            -2y - 2z^{\prime} + 2t^{\prime} = 0,
            2y +t^{\prime} = 0
        }
        \arrow[d] \\
        \systeme[sort={x, y, z, t}]{
            x + t^{\prime} = 0,
            y + \frac{1}{2}t^{\prime} = 0,
            z^{\prime} - \frac{3t^{\prime}}{2} = 0
        } &
        \systeme[sort={x, y, z, t}]{
            x + y + z^{\prime} = 0,
            -2y -2z^{\prime} + 2t^{\prime} = 0,
            -2z^{\prime} + 3t^{\prime} = 0
        }
        \arrow[l]
    \end{tikzcd}
\]

你说我是随便消元的，我可不是随便消元的，都是有章法的。
中学我们就学过加减消元法和代入消元法，对于这样一般的线性方程组，策略其实只有一种：一个式子消一个变量。

拿着式1把\(x\)全部消掉，也就是通过加减式1的若干倍，把其他式子中的\(x\)系数变为\(0\)。
\[
    \begin{tikzcd}[column sep=large, row sep=large]
        \systeme[sort={x, y, z, t}]{
            x + y + z^{\prime} = 0,
            2x + 2t^{\prime} = 0,
            2y + t^{\prime} = 0
        }
        \arrow[r, "R_{2} - 2R_{1}"] &
        \systeme[sort={x, y, z, t}]{
            x + y + z^{\prime} = 0,
            -2y - 2z^{\prime} + 2t^{\prime} = 0,
            2y +t^{\prime} = 0
        }
    \end{tikzcd}
\]
式1就不要动了，一个式子有一个式子的任务。接下来我们用式2干掉除式1外的所有式子中的\(y\)：
\[
    \begin{tikzcd}[column sep=large, row sep=large]
        \systeme[sort={x, y, z, t}]{
            x + y + z^{\prime} = 0,
            -2y - 2z^{\prime} + 2t^{\prime} = 0,
            2y +t^{\prime} = 0
        }
        \arrow[r, "R_{3} + R_{2}"] &
        \systeme[sort={x, y, z, t}]{
            x + y + z^{\prime} = 0,
            -2y -2z^{\prime} + 2t^{\prime} = 0,
            -2z^{\prime} + 3t^{\prime} = 0
        }
    \end{tikzcd}
\]

不难发现，这时方程的最后变成了\(- 2z^{\prime} + 3t^{\prime} = 0\) ，只含有\(z^{\prime}\)
和 \(t^{\prime}\) 两个变量，似乎这个方程并没有唯一的解。不过想来也合理，若是只有一个变量，岂不是方程所有的元都为零了？

这里\(t^{\prime} \) 实际上没有任何限制，每一个 \(t^{\prime} \) 都对应一个解。
被称作\textbf{自由变量}，在非平凡的意义下可以取除零外的任意值。

随便取\(t^{\prime} = -2\)，用\(t^{\prime} \) 解出\(z^{\prime} \)，
再用\(z^{\prime} \) 解出\(y\)，再用\(y\) 解出\(x\)（\textbf{反代法}）：
\[
    \systeme[sort={x, y, z, t}]{
        -2z^{\prime} + 3t^{\prime} = 0 @\implies z^{\prime} = -3,
        -2y -2z^{\prime} + 2t^{\prime} = 0 @\implies y = 1,
        x + y + z^{\prime} = 0 @\implies x = 2,
    }
\]
对这套算法而言，反应物和生成物在方程式里没有区别：正数解代表反应物，负数解代表生成物。只需把负数解移到方程式的另一边即可。我们得到最终的配平结果：
\[
    \ce{2 H2S + 1 SO2 -> 3 S v + 2 H2O}
\]

当然如果你不喜欢反代，也可以继续从方程的底端往上消元，直到每行只含有一个变量为止：
\[
    \begin{tikzcd}[column sep=large, row sep=large]
        \systeme[sort={x, y, z, t}]{
            x + y + z^{\prime} = 0,
            -2y -2z^{\prime} + 2t^{\prime} = 0,
            -2z^{\prime} + 3t^{\prime} = 0
        }
        \arrow[r, "R_{2} - R_{3}", "R_{1} + \frac{1}{2}R_{3}"'] &
        \systeme[sort={x, y, z, t}]{
            x + y + \frac{3}{2}t^{\prime} = 0,
            -2y - t^{\prime} = 0,
            -2z^{\prime} + 3t^{\prime} = 0
        }
        \arrow[r, "R_{1} + \frac{1}{2}R_{2}"] &
        \systeme[sort={x, y, z, t}]{
            x + t^{\prime} = 0,
            -2y - t^{\prime} = 0,
            -2z^{\prime} + 3t^{\prime} = 0
        }
    \end{tikzcd}
\]

于是，形如式a的，呈阶梯状的矩阵，我们称之为\textbf{行阶梯形矩阵}（Row Echelon Form，REF），而形如式b的，
每行的首个非零元都是1，且每行的首个非零元都在其上一行的首个非零元的右侧，我们称之为\textbf{行最简形矩阵}（Reduced Row
Echelon Form，RREF）。求解线性方程组的根本方法，就是把系数矩阵化为行阶梯形矩阵，甚至行最简形矩阵，然后回代求解所有变量。
这种方法有一个高级的名字，叫做\textbf{高斯-若当消元法}（Gauss-Jordan Elimination）。

在矩阵的语言下，以上的步骤可以写作：
\[
    \begin{bmatrix}[cccc|c]
        1 & 1 & 1 & 0 & 0\\
        2 & 0 & 0 & 2 & 0\\
        0 & 2 & 0 & 1 & 0
    \end{bmatrix}
    \xrightarrow{R_{2} - 2R_{1}}
    \begin{bmatrix}[cccc|c]
        1 & 1 & 1 & 0 & 0\\
        0 & -2 & -2 & 2 & 0\\
        0 & 2 & 0 & 1 & 0
    \end{bmatrix}
    \xrightarrow{R_{3} + R_{2}}
    \underbrace{
        \begin{bmatrix}[cccc|c]
            1 & 1 & 1 & 0 & 0\\
            0 & -2 & -2 & 2 & 0\\
            0 & 0 & -2 & 3 & 0
    \end{bmatrix}}_{\text{行阶梯形矩阵}}
\]
\[
    \begin{bmatrix}[cccc|c]
        1 & 1 & 1 & 0 & 0\\
        0 & -2 & -2 & 2 & 0\\
        0 & 0 & -2 & 3 & 0
    \end{bmatrix}
    \xrightarrow[R_{2} - R_{3}]{R_{1} + \frac{1}{2}R_{3}}
    \begin{bmatrix}[cccc|c]
        1 & 1 & \frac{3}{2} & 0 & 0\\
        0 & -2 & 1 & 2 & 0\\
        0 & 0 & -2 & 3 & 0
    \end{bmatrix}
    \xrightarrow{R_{1} + \frac{1}{2}R_{2}}
    \underbrace{
        \begin{bmatrix}[cccc|c]
            1 & 0 & 0 & 1 & 0\\
            0 & 1 & 0 & \frac{1}{2} & 0\\
            0 & 0 & 1 & -\frac{3}{2} & 0
    \end{bmatrix}}_{\text{行最简形矩阵}}
\]

当然，正式的高斯-若当消元法不只是一个式子消一个变量这么简单。解方程中所有允许的操作有：
\begin{definition}{初等行变换}
    对于一个线性方程组（以及其对应的增广矩阵），我们允许以下三种操作：
    \begin{itemize}
        \item 交换两行
        \item 将某一行乘以非零常数
        \item 将某一行加上另一行的若干倍
    \end{itemize}
\end{definition}

这些操作都不会改变线性方程组的解集。

完整版的消元法步骤为\footnote{高斯-若当消元法的具体细节可以在网上找到更多资料，这里只是给出一个简略的伪代码以供参考。
写出来我自己都不会看\UseVerb{grin}}：

\begin{algorithm}[H]
    \caption{高斯-若尔当消元法}
    \label{alg:gauss-jordan}
    \begin{algorithmic}[1]
        \State 设 \(A\) 是一个 \(m \times (n+1)\) 的增广矩阵。
        \State \( \text{主元行} \leftarrow 0 \)
        \For{\(j \leftarrow 0\) to \(n-1\)}  \Comment{遍历列}
        \State 找到 \(i \ge \text{主元行}\) 使得 \(A[i, j] \ne 0\)。
        \If{存在这样的 \(i\)}
        \State 交换第 \(i\) 行和第 \(\text{主元行}\)。
        \Comment{\(R_i \leftrightarrow R_{\text{主元行}}\)}
        \State 将第 \(\text{主元行}\) 除以
        \(A[\text{主元行}, j]\)。 \Comment{使主元元素为 1}
        \For{\(k \leftarrow 0\) to \(m-1\)} \Comment{消除第 \(j\) 列中的其他项}
        \If{\(k \ne \text{主元行}\)}
        \State 从第 \(k\) 行减去 \(A[k, j]\) 乘以第 \(\text{主元行}\)。
        \Comment{\(R_k \leftarrow R_k - A[k,j] \cdot
        R_{\text{主元行}}\)}
        \EndIf
        \EndFor
        \State \( \text{主元行} \leftarrow \text{主元行} + 1 \)
        \EndIf
        \EndFor
    \end{algorithmic}
\end{algorithm}

对于带电荷的化学方程式，我们只需在列出每个元素的守恒方程时，额外列出电荷守恒：
\[
    \begin{array}{c|*{5}{c@{\grayplus}}c|c}
        & \multicolumn{1}{c@{\grayplus}}{\ce{MnO2}} &
        \multicolumn{1}{c@{\grayplus}}{\ce{H+}} &
        \multicolumn{1}{c@{\grayto}}{\ce{Cl-}} &
        \multicolumn{1}{c@{\grayplus}}{\ce{Mn^2+}} &
        \multicolumn{1}{c@{\grayplus}}{\ce{H2O}} &
        \multicolumn{1}{c|}{\ce{Cl2 ^}} & \text{sum} \\
        \hline
        \ce{Mn} & 1 & 0 & 0 & -1 & 0 & 0 & 0\\
        \ce{O} & 2 & 0 & 0 & 0 & -1 & 0 & 0\\
        \ce{H} & 0 & 1 & 0 & 0 & -2 & 0 & 0\\
        \ce{Cl} & 0 & 0 & 1 & 0 & 0 & -2 & 0\\
        \ce{e^-} & 0 & -1 & 1 & -2 & 0 & 0 & 0\\
    \end{array}
\]
这种线性代数的方法不仅可以用于化学方程式，包括化学中的离子守恒（e.g. 在\(\ce{NaHCO3}\) 溶液中）：
\[
    c(\ce{OH^-}) + c(\ce{CO3^{2-}}) = c(\ce{H^+}) + c(\ce{H2CO3})
\]
乃至核物理方程式的配平：\[
    \ce{U235 + n1 \to Ba141 + Kr92 + 3n1}
\]
都遵循同样的数学原理。

\subsection{化学方程式的线性空间}

呼～终于摆脱了繁琐的计算\UseVerb{relaxed}

\subsubsection{维度基础}

维度，就是自由度。

在上例中，我们注意到解方程过程中自由变量只有\(t^{\prime}\) 一个，就可以说解空间的维数就是\(1\)。配平解可以写成这么个形式：
\begin{align*}
    &\placeholder{=}\ce{H2S +  SO2 -  S v + H2O}\\
    &= \lambda (\ce{H2S + 2 SO2 -> 3 S v + 2 H2O})
\end{align*}

对于那些有两个自由变量的化学方程式，解空间的维数就是\(2\)，如：
\begin{align*}
    &\placeholder{=}\ce{MnO4^- + H2O2 + H^+ - Mn^2+ + O2 + H2O} \\
    &=\lambda(\ce{2 MnO4^- + 5 H2O2 + 6 H^+ -> 2 Mn^2+ + 5 O2 ^ + 8 H2O}) \\
    &+\mu(\ce{2 H2O2 -> 2 O2 ^ + 2 H2O})
\end{align*}
\subsubsection{物种数 = 元素数 + 1?}

\begin{theorem}{线性映射基本定理}
    % todo: manage reference
    \cite{LinearAlgebraDone2024}
    假设\(V\) 是有限维的且 \(T \in \L(V,W)\)，那么\(\range
    T\) 是有限维的，且\[
        \dim V = \dim \nullspace T + \dim \range T
    \]
\end{theorem}

当\(T\)是满射时，\(\dim \range T = \dim V\)，也就是物理老师常讲的\(n\)个方程决定\(n\)个未知数。
当\(T\)不是满射时，方程组解的维数+线性变换的值域维数=定义域维数。

如果我们把系数矩阵看作是一个线性变换，那么该线性变换将化学系数空间（物种数空间）映射到元素种类空间。应用线性映射基本定理，我们可以得到：
\[
    \text{物种数} = \text{配平方法数} + \text{\hl{能产生的元素排列的维数}}
\]
\textbf{物种数}即反应物、生成物种类之和。
\textbf{配平方法数}就是相互独立的配平方法数\footnote{这里相互独立指的是不能相互“推导”的化学方程式解法，
即不能通过数乘和加法得到的配平方法，与向量的独立是一个意思}，也就是所有可行方程式配平系数的维数，
对于绝大多数化学方程式来说就是\(1\)。而\textbf{能产生的元素排列的维数}，简单来说就是元素种类数
\footnote{此处的元素种类数将电子看作一种元素}。举个例子：

\begin{center}
    \begin{tabular}{rcl}
        & \quad & $\placeholder{=}$ 配平方法数：$1$ \\
        \ce{Br2 + NH3 \to NH4Br + N2 ^}
        & & $+$ 元素数：$3$ \\
        & & $=$ 物种数：$4$ \\[1em]

        & \quad & $\placeholder{=}$ 配平方法数：$2$ \\
        \ce{2 MnO4^- + 7 H2O2 + 6 H^+ -> 2 Mn^2+ + 6 O2 ^ + 10 H2O}
        & & $+$ 元素数：$4$ \\
        & & $=$ 物种数：$6$
    \end{tabular}
\end{center}

然而，不是所有的化学方程式都满足这么美好的性质\UseVerb{sad}。考虑最简单的置换反应：曾青得铁，则化为铜
\[
    \begin{array}{rcl}
        & &\placeholder{+}\, \text{配平方法数：}1 \\
        \ce{Fe + CuSO4 \to FeSO4 + Cu} & \quad &+\, \text{元素数：}4 \\
        & &\neq \, \text{物种数：}4
    \end{array}
\]
这就是\hl{能产生的元素排列的维数}吊诡的地方了。具体来说，这里虽然一共有\(4\)种元素（\(\ce{Fe}\) ,
\(\ce{Cu}\) , \(\ce{S}\) , \(\ce{O}\)），但实际上\(\ce{S}\) 必与\(\ce{O}\)
以\(1:4\)的比例共存于\(\ce{SO4^{2-}}\) 中，于是元素排列的维数实际上只有\(3\)。

或许你会认为这种简单的问题可以通过把\(\ce{SO4^{2-}}\) 看作一个整体来解决，不妨试试：
\[
    \begin{array}{rcl}
        & &\placeholder{+}\, \text{配平方法数：}1 \\
        \ce{NH4NO2 \to  N2 + 2H2O} & \quad &+\, \text{元素数：}3 \\
        & &\neq \, \text{物种数：}3
    \end{array}
\]
还能看出来吗？这里\(\ce{H}\) 始终是两倍的\(\ce{O}\) 。

实际上我们考虑：
\begin{equation}
    \label{eq:NH4Cr2O7 decomp}
    \begin{array}{c|*{3}{c@{\grayplus}}c|c}
        & \multicolumn{1}{c@{\grayplus}}{\ce{(NH4)2Cr2O7}} &
        \multicolumn{1}{c@{\grayto}}{\ce{N2}} &
        \multicolumn{1}{c@{\grayplus}}{\ce{Cr2O3}} &
        \multicolumn{1}{c|}{\ce{H2O}} & \text{sum} \\
        \hline
        \ce{N} & 2 & 2 & 0 & 0 & 0\\
        \ce{H} & 8 & 0 & 0 & 2 & 0\\
        \ce{Cr} & 2 & 0 & 2 & 0 & 0\\
        \ce{O} & 7 & 0 & 3 & 1 & 0\\
    \end{array}
    \quad
    \begin{array}{cl}
        & \placeholder{+}\, \text{配平方法数：}1 \\
        \quad & +\, \text{元素数：}4 \\
        & \neq \, \text{物种数：}4
    \end{array}
\end{equation}
这下是不是看不出来了\UseVerb{smile}

其实\textbf{只需注意到}~\cref{eq:NH4Cr2O7 decomp}中元素之间并不是线性无关的：
\[
    r(\ce{H}) + 3r(\ce{Cr}) - 2r(\ce{O}) = 0
\]
% todo: 为什么是行的线性相关？

因此一般来说，化学方程式的物种数、配平方法数与元素排列维数不存在固定的关系。但对于大部分化学方程式来说，
能产生的元素排列的维数就是元素种类数，而配平方法数通常是\(1\) ，因此：
\[
    \text{物种数} \approx 1 + \text{元素种类数}
\]

从某种浪漫的角度来说，化学方程式的物种数与元素数相差的\(1\)，就是这个式子本身\UseVerb{smile}

\subsubsection{系数矩阵的空间们}

\noindent
\begin{minipage}[c]{0.5\textwidth}
    \[
        \begin{array}{c|*{5}{c}c}
            & \ce{MnO2} & \ce{H+} &\ce{Cl-} &\ce{Mn^2+} &\ce{H2O} &\ce{Cl2} \\
            \hline
            \ce{Mn} & 1 & 0 & 0 & -1 & 0 & 0\\
            \ce{O} & 2 & 0 & 0 & 0 & -1 & 0\\
            \ce{H} & 0 & 1 & 0 & 0 & -2 & 0\\
            \ce{Cl} & 0 & 0 & 1 & 0 & 0 & -2\\
            \ce{e^-} & 0 & -1 & 1 & -2 & 0 & 0\\
        \end{array}
    \]
\end{minipage}%
\hfill
\begin{minipage}[c]{0.45\textwidth}
    \textbf{列空间}：所有可能的元素排列空间。
    每一个列向量代表某物种的元素分量向量，秩代表能产生的元素排列的维数。
    \\[1em]
    \textbf{零空间}：所有可能的化学方程式配平方法空间。
    每一个零空间向量代表一种配平方法，维数代表能产生的独立配平方法的个数。
\end{minipage}
\vspace{1em}

真正难以理解的是系数矩阵的行空间。

当我们把系数矩阵\(A\) 看作一个线性映射时，\(A\)把物种系数向量映射到元素向量，矩阵的每一行，由各个物种在该元素上的系数构成，
以点乘的方式作用在系数上，得到元素的净数目。因此，系数矩阵的行向量本质上是一个\textbf{线性泛函}。
当我们只考虑元素数为零的化学方程式时，这些线性泛函的值都为零，也就是元素守恒。因此系数矩阵的行空间，
可以看作是所有\textbf{元素守恒关系}的空间。每一个行向量代表一条元素守恒，而行空间的维数，代表了这些守恒关系中线性无关的个数（即上例中发现的组合关系）。

在零空间上，行空间内的元素以泛函作用全得零，故可称行空间是零空间的\textbf{零化子}。
% todo:先搞清楚这四个空间的关系再写

\section{前人的智慧}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.9\textwidth]{resources/Jesse.pdf}
\end{figure}
配个方程式，哪有那么难？\UseVerb{angry}
\subsection{Look in my eyes!}

\printbibliography[heading=bibintoc,title={参考文献}]
\end{document}
