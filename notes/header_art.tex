% This preamble is heavily inspired by Soham Chatterjee's work in
% https://github.com/sohamch08/Eye-Candy-Lecture-Notes-Theme

% tex-fmt: off
% cSpell: disable
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% PACKAGE IMPORTS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{amsthm}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{booktabs}  % 提供更专业的表格线条
% Provide support for minipage used in definition environment
\usepackage{varwidth}
\usepackage[backend=biber,style=authortitle]{biblatex}
\usepackage{array}     % 增强的表格功能
% Underline and strikethrough
\usepackage[normalem]{ulem}
\usepackage[dvipsnames]{xcolor}
\usepackage[most,many,breakable]{tcolorbox}
\usepackage{extarrows}
\usepackage{derivative}
\usepackage{tikz-cd}
% Make sure all math formulas are displayed in displaystyle
\usepackage{breqn}
% Some may argue that the use of displaystyle in inline formulas may
% break line spacing and make the document look ugly. However, I
% prefer to follow the choice of the textbook setting
\everymath{\displaystyle}
% For \mathscr
\usepackage{mathrsfs}
\usepackage{graphicx}
% Title and ToC format
\usepackage{titletoc,titlesec}
\usepackage{float}
\usepackage{tikz}
% For bold math symbols
\usepackage{bm}
\usepackage{mathtools} % For \coloneqq
\usepackage{hyperref}
\hypersetup{%
 colorlinks=true, linkcolor=mydoccolor!80, urlcolor=mydoccolor!80,
 citecolor=mycitecolor!80!black,
 bookmarksnumbered=true,
 bookmarksopen=true
}
\usepackage{cleveref}
\usepackage{titling}
% Use verb inside other environments
\usepackage{fancyvrb}
\VerbatimFootnotes
\SaveVerb{smile}|:-)|
\SaveVerb{laugh}|:-D|
\SaveVerb{wink}|;-)|
\SaveVerb{sad}|:-(|
\SaveVerb{angry}|:-@|
\SaveVerb{confused}|:-S|
\SaveVerb{cool}|B-)|
\SaveVerb{cry}|:'-|
\SaveVerb{kiss}|:-*|
\SaveVerb{surprised}|:-o|
\SaveVerb{grin}|:-]|
\SaveVerb{naughty}|:P|
% \setCJKmainfont[BoldFont=SimHei,ItalicFont=FangSong,BoldItalicFont=LiSu]{SimSun}
% For cancel line
\usepackage{cancel}
% For code highlighting
\usepackage{listings}
\newfontfamily{\Cascadia}{Cascadia Code}
\lstset{language=Mathematica}
\lstset{basicstyle={\Cascadia\footnotesize},
    numbers=left,
    numberstyle=\tiny\color{gray},
    numbersep=5pt,
    breaklines=true,
    captionpos={t},
    frame={lines},
    rulecolor=\color{black},
    framerule=0.5pt,
    columns=flexible,
    tabsize=4
}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Custom commands
%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%================================
% PAGE SETUP
%================================

\renewcommand{\thesection}{\textbf{\chinese{section}}、\hspace{-1em}}
\renewcommand{\thesubsection}{\arabic{subsection}.\hspace{-0.3em}}
\renewcommand{\thesubsubsection}{\arabic{subsubsection}}
\catcode`\。=\active\newcommand{。}{．}
\ctexset{section={format={\Large\raggedright\bfseries}}}
%================================
% MATH COMMANDS
%==========================\hl{}===
\AtBeginDocument{%
\renewcommand\Re{\operatorname{Re}}
\renewcommand\Im{\operatorname{Im}}
}
\renewcommand{\i}{\mathrm{i}}
\newcommand{\e}{\mathrm{e}}
\renewcommand{\d}{\odif}

\newcommand{\R}{\mathbb{R}} % Real
\newcommand{\C}{\mathbb{C}} % Complex
\newcommand{\Z}{\mathbb{Z}} % Integer, from Zahlen, by David Hilbert
\newcommand{\Q}{\mathbb{Q}} % Rational, from Quotient
\newcommand{\N}{\mathbb{N}} % Natural, from Naturals

\newcommand{\abs}[1]{\left|#1\right|} % Absolute value

\newcommand{\placeholder}[1]{\mathrel{\phantom{#1}}} % Placeholder

\crefname{equation}{式}{式}
\Crefname{equation}{式}{式}
\crefname{theorem}{定理}{定理}
\Crefname{theorem}{定理}{定理}
\crefname{definition}{定义}{定义}
\Crefname{definition}{定义}{定义}
\crefname{problem}{问题}{问题}
\Crefname{problem}{问题}{问题}
\crefname{claim}{断言}{断言}
\Crefname{claim}{断言}{断言}
\crefname{note}{注}{注}
\Crefname{note}{注}{注}

%================================
% DOCUMENT SETUP
%================================

\newcommand\hl{\bgroup\markoverwith{\textcolor{yellow}{\rule[-.5ex]{2pt}{2.5ex}}}\ULon}

\newfontfamily\DancingScript{Dancing Script OT}
\newcommand{\Caffein}{\DancingScript{Caffein3}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% COLORS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\definecolor{myclaimcolor}{RGB}{56, 140, 70}
\definecolor{mynotecolor}{RGB}{56, 140, 70}
\definecolor{mytheoremcolor}{RGB}{0,102,204}
\definecolor{mydefinitioncolor}{RGB}{235, 105,12}
\definecolor{myquotecolor}{RGB}{161,143,125}
\definecolor{mycitecolor}{RGB}{0, 102, 204}
\definecolor{myproblemcolor}{RGB}{255,128,0}
\definecolor{mydoccolor}{RGB}{141,64,13}

% There is no ToC in article class

%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% New environments
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%! Caution: All environments with CAPITALIZED first letter
%! is for internal use only
\tcbuselibrary{theorems,skins,hooks}
%================================
% THEOREM BOX
%================================
\newtcbtheorem[number within=section]{Theorem}{Theorem}
{%
    enhanced,
    breakable,
    colback = mytheoremcolor!10,
    frame hidden,
    boxrule = 0sp,
    borderline west = {2pt}{0pt}{mytheoremcolor},
    sharp corners,
    detach title,
    before upper = \tcbtitle\par\smallskip,
    coltitle = mytheoremcolor!85!black,
    fonttitle = \bfseries\sffamily,
    description font = \mdseries,
    separator sign none,
    segmentation style={solid, mytheoremcolor!85!black},
}
{theorem}

\newenvironment{theorem}[2][]{%
    \begin{Theorem}{#2}{#1}%
    }{%
    \end{Theorem}%
}

%================================
% DEFINITION BOX
%================================
\makeatletter
\newtcbtheorem[number within=section]{Definition}{Definition}{enhanced,
    breakable,
    colback=mydefinitioncolor!8,
    colframe=mydefinitioncolor,
    attach boxed title to top left={yshift*=-\tcboxedtitleheight},
    fonttitle=\bfseries,
    title={#2},
    boxed title size=title,
    boxed title style={%
        sharp corners,
        rounded corners=northwest,
        colback=tcbcolframe,
        boxrule=0pt,
    },
    underlay boxed title={%
        \path[fill=tcbcolframe] (title.south west)--(title.south east)
        to[out=0, in=180] ([xshift=5mm]title.east)--
        (title.center-|frame.east)
        [rounded corners=\kvtcb@arc] |-
        (frame.north) -| cycle;
    },
    #1
}{definition}
\makeatother

\newenvironment{definition}[2][]{%
    \begin{Definition}{#2}{#1}%
    }{%
    \end{Definition}%
}

%================================
% PROBLEM BOX
%================================
\newtcbtheorem[number within=section]{Problem}{Problem}
{%
    enhanced,
    breakable,
    colback = myproblemcolor!10,
    frame hidden,
    boxrule = 0sp,
    borderline west = {2pt}{0pt}{myproblemcolor},
    sharp corners,
    detach title,
    before upper = \tcbtitle\par\smallskip,
    coltitle = myproblemcolor!85!black,
    fonttitle = \bfseries\sffamily,
    description font = \mdseries,
    separator sign none,
    segmentation style={solid, myproblemcolor!85!black},
}
{problem}

\newenvironment{problem}[2][]{%
    \begin{Problem}{#2}{#1}%
    }{%
    \end{Problem}%
}
%================================
% CLAIM BOX
%================================
\newtcbtheorem[number within=section]{Claim}{Claim}
{%
    enhanced
    ,breakable
    ,colback = myclaimcolor!10
    ,frame hidden
    ,boxrule = 0sp
    ,borderline west = {2pt}{0pt}{myclaimcolor}
    ,sharp corners
    ,detach title
    ,before upper = \tcbtitle\par\smallskip
    ,coltitle = myclaimcolor!85!black
    ,fonttitle = \bfseries\sffamily
    ,description font = \mdseries
    ,separator sign none
    ,segmentation style={solid, myclaimcolor!85!black}
}
{claim}

\newenvironment{claim}[2][]{%
    \begin{Claim}{#2}{#1}%
    }{%
    \end{Claim}%
}

%================================
% NOTE BOX
%================================

\newtcbtheorem[number within=section]{Note}{Note}
{%
    enhanced
    ,breakable
    ,colback = mynotecolor!10
    ,frame hidden
    ,boxrule = 0sp
    ,borderline west = {2pt}{0pt}{mynotecolor}
    ,sharp corners
    ,detach title
    ,before upper = \tcbtitle\par\smallskip
    ,coltitle = mynotecolor!85!black
    ,fonttitle = \bfseries\sffamily
    ,description font = \mdseries
    ,separator sign none
    ,segmentation style={solid, mynotecolor!85!black}
}
{note}

\newenvironment{note}[2][]{%
    \begin{Note}{#2}{#1}%
    }{%
    \end{Note}%
}
%================================
% QUOTE BOX
%================================
\newtcolorbox{refbox}[1][]{%
enhanced,
breakable,
colback = myquotecolor!10,
frame hidden,
boxrule = 0sp,
borderline west = {2pt}{0pt}{myquotecolor},
sharp corners,
fontupper = \ttfamily,
#1
}
\renewenvironment{quote}{%
\begin{refbox}}{%
\end{refbox}}
% Extra Information
% INFO: Use \mathclap and \substack to create multiline